<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AntarAalay AR - Interior Visualization</title>
    <meta name="description" content="Experience your interior design in augmented reality">
    
    <!-- Model-Viewer for AR -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.0.1/model-viewer.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        model-viewer {
            width: 100%;
            height: 100vh;
            background: transparent;
        }
        
        .ar-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 1000;
        }
        
        .vastu-compass {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .compass-ring {
            width: 100px;
            height: 100px;
            border: 3px solid #C6A75E;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .compass-direction {
            position: absolute;
            font-weight: bold;
            color: #1F1F1F;
            font-size: 14px;
        }
        
        .north { top: 5px; left: 50%; transform: translateX(-50%); }
        .south { bottom: 5px; left: 50%; transform: translateX(-50%); }
        .east { right: 5px; top: 50%; transform: translateY(-50%); }
        .west { left: 5px; top: 50%; transform: translateY(-50%); }
        
        .compass-center {
            width: 10px;
            height: 10px;
            background: #C6A75E;
            border-radius: 50%;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: white;
        }
        
        .ar-button {
            background: #C6A75E;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ar-button:hover {
            background: #B8964F;
            transform: translateY(-2px);
        }
        
        .info-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 200px;
            z-index: 1000;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #C6A75E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <h2 class="mt-4 text-xl font-semibold">Loading AR Experience...</h2>
        <p class="mt-2 text-sm opacity-80">Preparing your interior design</p>
    </div>

    <!-- AR Model Viewer -->
    <model-viewer
        id="arViewer"
        src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
        ios-src="https://modelviewer.dev/shared-assets/models/Astronaut.usdz"
        ar
        ar-modes="scene-viewer quick-look webxr"
        camera-controls
        auto-rotate
        environment-image="neutral"
        exposure="0.5"
        shadow-intensity="1"
        ar-scale="auto"
        style="width: 100%; height: 100vh;"
    >
        <div class="progress-bar hide" slot="progress-bar">
            <div class="update-bar"></div>
        </div>
    </model-viewer>

    <!-- Vastu Compass -->
    <div class="vastu-compass">
        <div class="compass-ring" id="compassRing">
            <div class="compass-direction north">N</div>
            <div class="compass-direction east">E</div>
            <div class="compass-direction south">S</div>
            <div class="compass-direction west">W</div>
            <div class="compass-center"></div>
        </div>
        <div class="text-xs mt-2 font-semibold text-gray-700">VASTU</div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel">
        <h3 class="font-bold text-sm mb-2">Design Info</h3>
        <div class="text-xs space-y-1">
            <div><strong>Style:</strong> <span id="designStyle">Modern</span></div>
            <div><strong>Room:</strong> <span id="roomType">Living Room</span></div>
            <div><strong>Status:</strong> <span class="text-green-600">AR Ready</span></div>
        </div>
    </div>

    <!-- AR Controls -->
    <div class="ar-controls">
        <button class="ar-button" onclick="enterAR()">
            <i class="fas fa-cube"></i>
            Enter AR
        </button>
        <button class="ar-button" onclick="takeScreenshot()">
            <i class="fas fa-camera"></i>
            Capture
        </button>
        <button class="ar-button" onclick="resetView()">
            <i class="fas fa-undo"></i>
            Reset
        </button>
        <button class="ar-button" onclick="exitAR()">
            <i class="fas fa-times"></i>
            Exit
        </button>
    </div>

    <script>
        // Get session ID from URL
        const sessionId = window.location.pathname.split('/').pop();
        
        // Initialize AR experience
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AR Session ID:', sessionId);
            
            // Hide loading overlay after model loads
            const modelViewer = document.getElementById('arViewer');
            
            modelViewer.addEventListener('load', function() {
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 1000);
            });
            
            // Initialize compass
            initializeCompass();
            
            // Load design data
            loadDesignData();
            
            // Handle AR session
            updateARSessionStatus('active');
        });
        
        // Initialize Vastu Compass
        function initializeCompass() {
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', function(event) {
                    if (event.alpha !== null) {
                        const compass = document.getElementById('compassRing');
                        compass.style.transform = `rotate(${-event.alpha}deg)`;
                    }
                });
            }
        }
        
        // Enter AR Mode
        function enterAR() {
            const modelViewer = document.getElementById('arViewer');
            modelViewer.activateAR();
            console.log('Entering AR mode...');
        }
        
        // Take Screenshot
        function takeScreenshot() {
            const modelViewer = document.getElementById('arViewer');
            const dataUri = modelViewer.toDataURL();
            
            // Create download link
            const link = document.createElement('a');
            link.download = `antaralay-ar-${sessionId}-${Date.now()}.png`;
            link.href = dataUri;
            link.click();
            
            console.log('Screenshot captured!');
        }
        
        // Reset View
        function resetView() {
            const modelViewer = document.getElementById('arViewer');
            modelViewer.resetCamera();
            console.log('View reset');
        }
        
        // Exit AR
        function exitAR() {
            updateARSessionStatus('completed');
            window.close();
            
            // Fallback for mobile browsers
            if (!window.closed) {
                window.location.href = 'https://antaralay.ai';
            }
        }
        
        // Load Design Data
        async function loadDesignData() {
            try {
                // In production, fetch from your API
                const designData = {
                    style: 'Modern',
                    roomType: 'Living Room',
                    wallColor: '#F4EFE6',
                    flooringMaterial: 'Hardwood'
                };
                
                document.getElementById('designStyle').textContent = designData.style;
                document.getElementById('roomType').textContent = designData.roomType;
                
            } catch (error) {
                console.error('Failed to load design data:', error);
            }
        }
        
        // Update AR Session Status
        async function updateARSessionStatus(status) {
            try {
                // In production, update your backend
                console.log('AR Session Status:', status);
                
                // Send beacon to backend for analytics
                if (navigator.sendBeacon) {
                    navigator.sendBeacon(`/api/ar/session/${sessionId}/status`, 
                        JSON.stringify({ status, timestamp: new Date().toISOString() })
                    );
                }
                
            } catch (error) {
                console.error('Failed to update session status:', error);
            }
        }
        
        // Handle page visibility change
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                updateARSessionStatus('paused');
            } else {
                updateARSessionStatus('active');
            }
        });
        
        // Handle page unload
        window.addEventListener('beforeunload', function() {
            updateARSessionStatus('completed');
        });
        
        // Error handling
        window.addEventListener('error', function(e) {
            console.error('AR Error:', e.error);
            document.getElementById('loadingOverlay').innerHTML = `
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                    <h2 class="text-xl font-semibold mb-2">AR Experience Error</h2>
                    <p class="text-sm opacity-80">Please refresh and try again</p>
                    <button onclick="location.reload()" class="mt-4 ar-button">
                        <i class="fas fa-refresh"></i>
                        Refresh
                    </button>
                </div>
            `;
        });
    </script>
</body>
</html>
