<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AntarAalay - AR Home Decor Visualization</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/@webxr-input-profiles/motion-controllers@1.0.0/dist/motion-controllers.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }
        
        .ar-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 15px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .ar-btn {
            background: #C6A75E;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ar-btn:hover {
            background: #B8941F;
            transform: translateY(-2px);
        }
        
        .ar-btn:active {
            transform: translateY(0);
        }
        
        .room-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 12px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            max-width: 250px;
        }
        
        .room-info h3 {
            margin-bottom: 10px;
            color: #C6A75E;
            font-size: 16px;
        }
        
        .room-info p {
            margin: 5px 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .vastu-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 12px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .vastu-indicator.excellent {
            border: 2px solid #32CD32;
        }
        
        .vastu-indicator.good {
            border: 2px solid #FFD700;
        }
        
        .vastu-indicator.poor {
            border: 2px solid #FF6347;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }
        
        .loading.hidden {
            display: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #C6A75E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .instructions {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            z-index: 1500;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .instructions.hidden {
            display: none;
        }
        
        .instructions h2 {
            margin-bottom: 20px;
            color: #C6A75E;
        }
        
        .instructions p {
            margin: 10px 0;
            line-height: 1.5;
        }
        
        .instructions button {
            background: #C6A75E;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <h2>üè† Loading AR Home Decor...</h2>
        <p>Preparing your Vastu-compliant space</p>
    </div>
    
    <!-- Instructions -->
    <div id="instructions" class="instructions">
        <h2>üè† AR Home Decor Setup</h2>
        <p><strong>Step 1:</strong> Allow camera access</p>
        <p><strong>Step 2:</strong> Point camera at a flat surface</p>
        <p><strong>Step 3:</strong> Tap to place furniture</p>
        <p><strong>Step 4:</strong> Walk around to view from all angles</p>
        <button onclick="startAR()">Start AR Experience</button>
    </div>
    
    <!-- AR Scene -->
    <a-scene 
        id="ar-scene"
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false">
        
        <!-- Camera -->
        <a-camera gps-camera rotation-reader></a-camera>
        
        <!-- Light -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 1 0" color="#ffffff" intensity="0.5"></a-light>
        
        <!-- Living Room Furniture -->
        <a-entity id="living-room" visible="false">
            <!-- Sofa -->
            <a-box 
                id="sofa" 
                position="0 0.5 -2" 
                width="2" 
                height="0.8" 
                depth="0.8" 
                color="#8B4513"
                shadow>
                <a-animation attribute="rotation" dur="2000" to="0 360 0" repeat="indefinite"></a-animation>
            </a-box>
            
            <!-- Coffee Table -->
            <a-box 
                id="coffee-table" 
                position="0 0.3 -1" 
                width="1.2" 
                height="0.6" 
                depth="0.6" 
                color="#D2691E"
                shadow>
            </a-box>
            
            <!-- TV Unit -->
            <a-box 
                id="tv-unit" 
                position="0 1 -3" 
                width="1.8" 
                height="0.1" 
                depth="0.3" 
                color="#000000"
                shadow>
            </a-box>
            
            <!-- Bookshelf -->
            <a-box 
                id="bookshelf" 
                position="-2 1 -2" 
                width="0.3" 
                height="2" 
                depth="1" 
                color="#654321"
                shadow>
            </a-box>
        </a-entity>
        
        <!-- Bedroom Furniture -->
        <a-entity id="bedroom" visible="false">
            <!-- Bed -->
            <a-box 
                id="bed" 
                position="0 0.4 -2" 
                width="1.6" 
                height="0.8" 
                depth="2" 
                color="#F4EFE6"
                shadow>
            </a-box>
            
            <!-- Wardrobe -->
            <a-box 
                id="wardrobe" 
                position="2 1 -2" 
                width="0.6" 
                height="2" 
                depth="1" 
                color="#8B4513"
                shadow>
            </a-box>
            
            <!-- Nightstand -->
            <a-box 
                id="nightstand" 
                position="-1 0.4 -1" 
                width="0.4" 
                height="0.8" 
                depth="0.4" 
                color="#654321"
                shadow>
            </a-box>
        </a-entity>
        
        <!-- Kitchen Furniture -->
        <a-entity id="kitchen" visible="false">
            <!-- Kitchen Cabinet -->
            <a-box 
                id="kitchen-cabinet" 
                position="0 1 -2" 
                width="2" 
                height="2" 
                depth="0.6" 
                color="#F5F5DC"
                shadow>
            </a-box>
            
            <!-- Stove -->
            <a-box 
                id="stove" 
                position="0 1 -1.5" 
                width="0.8" 
                height="0.1" 
                depth="0.8" 
                color="#C0C0C0"
                shadow>
            </a-box>
            
            <!-- Refrigerator -->
            <a-box 
                id="refrigerator" 
                position="1.5 1 -2" 
                width="0.6" 
                height="2" 
                depth="0.6" 
                color="#FFFFFF"
                shadow>
            </a-box>
        </a-entity>
        
        <!-- Office Furniture -->
        <a-entity id="office" visible="false">
            <!-- Desk -->
            <a-box 
                id="desk" 
                position="0 0.8 -1" 
                width="1.2" 
                height="0.1" 
                depth="0.6" 
                color="#8B4513"
                shadow>
            </a-box>
            
            <!-- Chair -->
            <a-box 
                id="chair" 
                position="0 0.5 -0.5" 
                width="0.5" 
                height="1" 
                depth="0.5" 
                color="#654321"
                shadow>
            </a-box>
            
            <!-- Bookshelf -->
            <a-box 
                id="office-bookshelf" 
                position="-1.5 1 -1.5" 
                width="0.3" 
                height="2" 
                depth="0.8" 
                color="#8B4513"
                shadow>
            </a-box>
        </a-entity>
        
        <!-- Floor Marker -->
        <a-marker preset="hiro">
            <a-plane position="0 0 0" rotation="-90 0 0" width="4" height="4" color="#CCCCCC" opacity="0.3"></a-plane>
        </a-marker>
    </a-scene>
    
    <!-- Room Info Panel -->
    <div class="room-info">
        <h3 id="room-name">Living Room</h3>
        <p><strong>Style:</strong> <span id="room-style">Modern</span></p>
        <p><strong>Vastu Zone:</strong> <span id="vastu-zone">North</span></p>
        <p><strong>Element:</strong> <span id="element">Air</span></p>
    </div>
    
    <!-- Vastu Indicator -->
    <div id="vastu-indicator" class="vastu-indicator">
        <h4>üßò Vastu Score</h4>
        <p id="vastu-score">85%</p>
        <p id="vastu-status">Excellent</p>
    </div>
    
    <!-- AR Controls -->
    <div class="ar-controls">
        <button class="ar-btn" onclick="changeRoom()">üè† Change Room</button>
        <button class="ar-btn" onclick="changeStyle()">üé® Change Style</button>
        <button class="ar-btn" onclick="checkVastu()">üßò Vastu Check</button>
        <button class="ar-btn" onclick="takeScreenshot()">üì∏ Screenshot</button>
    </div>
    
    <script>
        // Room configurations
        const rooms = {
            living: {
                name: 'Living Room',
                style: 'Modern',
                vastuZone: 'North',
                element: 'Air',
                score: 85,
                furniture: ['sofa', 'coffee-table', 'tv-unit', 'bookshelf']
            },
            bedroom: {
                name: 'Bedroom',
                style: 'Modern',
                vastuZone: 'Southwest',
                element: 'Earth',
                score: 90,
                furniture: ['bed', 'wardrobe', 'nightstand']
            },
            kitchen: {
                name: 'Kitchen',
                style: 'Modern',
                vastuZone: 'Southeast',
                element: 'Fire',
                score: 88,
                furniture: ['kitchen-cabinet', 'stove', 'refrigerator']
            },
            office: {
                name: 'Home Office',
                style: 'Modern',
                vastuZone: 'West',
                element: 'Air',
                score: 82,
                furniture: ['desk', 'chair', 'office-bookshelf']
            }
        };
        
        const styles = ['Modern', 'Traditional', 'Vastu', 'Minimalist'];
        let currentRoom = 'living';
        let currentStyleIndex = 0;
        
        // Get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                designId: params.get('designId') || 'demo',
                roomId: params.get('roomId') || 'demo',
                userId: params.get('userId') || 'demo',
                style: params.get('style') || 'modern'
            };
        }
        
        // Initialize AR
        function initAR() {
            console.log('üè† Initializing AR Home Decor...');
            
            const params = getUrlParams();
            console.log('üì± User parameters:', params);
            
            // Hide loading after 2 seconds
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('instructions').classList.remove('hidden');
            }, 2000);
            
            // Show initial room
            showRoom(currentRoom);
            updateVastuIndicator();
        }
        
        // Start AR
        function startAR() {
            console.log('üöÄ Starting AR Experience...');
            document.getElementById('instructions').classList.add('hidden');
            
            // Request camera permissions
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(() => {
                        console.log('‚úÖ Camera access granted');
                        // AR.js will handle the rest
                    })
                    .catch((error) => {
                        console.error('‚ùå Camera access denied:', error);
                        alert('Camera access is required for AR experience');
                    });
            }
        }
        
        // Show room
        function showRoom(roomId) {
            // Hide all rooms
            Object.keys(rooms).forEach(room => {
                document.getElementById(room).setAttribute('visible', 'false');
            });
            
            // Show selected room
            document.getElementById(roomId).setAttribute('visible', 'true');
            
            // Update info panel
            const room = rooms[roomId];
            document.getElementById('room-name').textContent = room.name;
            document.getElementById('room-style').textContent = room.style;
            document.getElementById('vastu-zone').textContent = room.vastuZone;
            document.getElementById('element').textContent = room.element;
            
            console.log(`üè† Showing ${room.name}`);
        }
        
        // Change room
        function changeRoom() {
            const roomKeys = Object.keys(rooms);
            const currentIndex = roomKeys.indexOf(currentRoom);
            const nextIndex = (currentIndex + 1) % roomKeys.length;
            currentRoom = roomKeys[nextIndex];
            showRoom(currentRoom);
            updateVastuIndicator();
        }
        
        // Change style
        function changeStyle() {
            currentStyleIndex = (currentStyleIndex + 1) % styles.length;
            const newStyle = styles[currentStyleIndex];
            
            // Update all rooms with new style
            Object.keys(rooms).forEach(room => {
                rooms[room].style = newStyle;
            });
            
            // Update current room display
            document.getElementById('room-style').textContent = newStyle;
            
            console.log(`üé® Changed style to ${newStyle}`);
        }
        
        // Check Vastu
        function checkVastu() {
            const room = rooms[currentRoom];
            const score = room.score + (currentStyleIndex === 2 ? 10 : 0); // Vastu style gets bonus
            const finalScore = Math.min(score, 100);
            
            let status = 'Good';
            let indicatorClass = 'good';
            
            if (finalScore >= 90) {
                status = 'Excellent';
                indicatorClass = 'excellent';
            } else if (finalScore < 80) {
                status = 'Needs Adjustment';
                indicatorClass = 'poor';
            }
            
            // Update Vastu indicator
            const indicator = document.getElementById('vastu-indicator');
            indicator.className = `vastu-indicator ${indicatorClass}`;
            document.getElementById('vastu-score').textContent = `${finalScore}%`;
            document.getElementById('vastu-status').textContent = status;
            
            console.log(`üßò Vastu check: ${finalScore}% - ${status}`);
        }
        
        // Update Vastu indicator
        function updateVastuIndicator() {
            checkVastu();
        }
        
        // Take screenshot
        function takeScreenshot() {
            const canvas = document.createElement('canvas');
            const scene = document.getElementById('ar-scene');
            
            // Simple screenshot simulation
            alert('üì∏ Screenshot captured! In production, this would save an image of your AR room design.');
            
            console.log('üì∏ Screenshot captured');
        }
        
        // Handle device orientation for Vastu
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', function(event) {
                const alpha = event.alpha;
                if (alpha !== null) {
                    // Update Vastu based on device orientation
                    const room = rooms[currentRoom];
                    const zoneScore = calculateVastuScore(alpha, room.vastuZone);
                    
                    if (zoneScore > 80) {
                        document.getElementById('vastu-indicator').className = 'vastu-indicator excellent';
                    } else if (zoneScore > 60) {
                        document.getElementById('vastu-indicator').className = 'vastu-indicator good';
                    } else {
                        document.getElementById('vastu-indicator').className = 'vastu-indicator poor';
                    }
                }
            });
        }
        
        // Calculate Vastu score based on orientation
        function calculateVastuScore(alpha, recommendedZone) {
            const zoneAngles = {
                'North': 0, 'Northeast': 45, 'East': 90,
                'Southeast': 135, 'South': 180, 'Southwest': 225,
                'West': 270, 'Northwest': 315
            };
            
            const recommendedAngle = zoneAngles[recommendedZone] || 0;
            const difference = Math.abs(alpha - recommendedAngle);
            const normalizedDiff = Math.min(difference, 360 - difference);
            
            return Math.max(0, 100 - (normalizedDiff / 180) * 100);
        }
        
        // Initialize on load
        window.addEventListener('load', initAR);
        
        // Handle errors
        window.addEventListener('error', function(e) {
            console.error('‚ùå AR Error:', e.error);
            document.getElementById('loading').classList.add('hidden');
            alert('AR experience encountered an error. Please refresh and try again.');
        });
    </script>
</body>
</html>
