<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AntarAalay AR - Interior Design & Vastu Visualization</title>
    <meta name="description" content="Experience your interior design with Vastu guidance in augmented reality">
    
    <!-- Model-Viewer for AR -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.0.1/model-viewer.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        model-viewer {
            width: 100%;
            height: 100vh;
            background: transparent;
        }
        
        .ar-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 1000;
        }
        
        .vastu-compass {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 140px;
            height: 140px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .compass-ring {
            width: 120px;
            height: 120px;
            border: 3px solid #C6A75E;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .vastu-zone {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }
        
        .zone-ne { background: #87CEEB; top: 5px; left: 50%; transform: translateX(-50%); }
        .zone-e { background: #FFD700; right: 5px; top: 50%; transform: translateY(-50%); }
        .zone-se { background: #FF6347; bottom: 5px; right: 5px; }
        .zone-s { background: #FF69B4; bottom: 5px; left: 50%; transform: translateX(-50%); }
        .zone-w { background: #87CEFA; left: 5px; top: 50%; transform: translateY(-50%); }
        .zone-nw { background: #DDA0DD; top: 5px; left: 5px; }
        .zone-n { background: #32CD32; top: 5px; left: 50%; transform: translateX(-50%); }
        .zone-sw { background: #8B4513; bottom: 5px; left: 5px; }
        
        .compass-center {
            width: 12px;
            height: 12px;
            background: #C6A75E;
            border-radius: 50%;
            z-index: 10;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: white;
        }
        
        .ar-button {
            background: #C6A75E;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ar-button:hover {
            background: #B8964F;
            transform: translateY(-2px);
        }
        
        .info-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 250px;
            z-index: 1000;
        }
        
        .design-selector {
            position: fixed;
            top: 180px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 250px;
            z-index: 1000;
        }
        
        .room-option, .style-option {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .room-option:hover, .style-option:hover {
            background: #C6A75E;
            color: white;
        }
        
        .room-option.selected, .style-option.selected {
            background: #C6A75E;
            color: white;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #C6A75E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .vastu-analysis {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 200px;
            z-index: 1000;
        }
        
        .compliance-score {
            font-size: 24px;
            font-weight: bold;
            color: #32CD32;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <h2 class="mt-4 text-xl font-semibold">Loading Interior Design AR...</h2>
        <p class="mt-2 text-sm opacity-80">Preparing your Vastu-compliant space</p>
    </div>

    <!-- AR Model Viewer -->
    <model-viewer
        id="arViewer"
        src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
        ios-src="https://modelviewer.dev/shared-assets/models/Astronaut.usdz"
        ar
        ar-modes="scene-viewer quick-look webxr"
        camera-controls
        auto-rotate
        environment-image="neutral"
        exposure="0.5"
        shadow-intensity="1"
        ar-scale="auto"
        style="width: 100%; height: 100vh;"
    >
        <div class="progress-bar hide" slot="progress-bar">
            <div class="update-bar"></div>
        </div>
    </model-viewer>

    <!-- Design Info Panel -->
    <div class="info-panel">
        <h3 class="font-bold text-sm mb-2">Interior Design</h3>
        <div class="text-xs space-y-1">
            <div><strong>Room:</strong> <span id="currentRoom">Living Room</span></div>
            <div><strong>Style:</strong> <span id="currentStyle">Modern</span></div>
            <div><strong>Vastu Score:</strong> <span id="vastuScore" class="text-green-600">85%</span></div>
            <div><strong>Element:</strong> <span id="vastuElement">Fire</span></div>
        </div>
    </div>

    <!-- Design Selector -->
    <div class="design-selector">
        <h3 class="font-bold text-sm mb-2">Customize Design</h3>
        
        <div class="mb-3">
            <div class="text-xs font-semibold mb-1">Room Type</div>
            <div class="room-option selected" data-room="living">üõãÔ∏è Living Room</div>
            <div class="room-option" data-room="bedroom">üõèÔ∏è Bedroom</div>
            <div class="room-option" data-room="kitchen">üç≥ Kitchen</div>
            <div class="room-option" data-room="office">üíº Home Office</div>
        </div>
        
        <div>
            <div class="text-xs font-semibold mb-1">Design Style</div>
            <div class="style-option selected" data-style="modern">‚ú® Modern</div>
            <div class="style-option" data-style="traditional">üèõÔ∏è Traditional</div>
            <div class="style-option" data-style="vastu">üßò Vastu</div>
            <div class="style-option" data-style="minimalist">‚ö™ Minimalist</div>
        </div>
    </div>

    <!-- Enhanced Vastu Compass with Zones -->
    <div class="vastu-compass">
        <div class="compass-ring" id="compassRing">
            <!-- Vastu Zones with Elements -->
            <div class="vastu-zone zone-ne" title="Northeast - Water Element">üíß</div>
            <div class="vastu-zone zone-e" title="East - Sun Element">‚òÄÔ∏è</div>
            <div class="vastu-zone zone-se" title="Southeast - Fire Element">üî•</div>
            <div class="vastu-zone zone-s" title="South - Yama">üåπ</div>
            <div class="vastu-zone zone-w" title="West - Air Element">üí®</div>
            <div class="vastu-zone zone-nw" title="Northwest - Vayu">üå™Ô∏è</div>
            <div class="vastu-zone zone-n" title="North - Kubera">üí∞</div>
            <div class="vastu-zone zone-sw" title="Southwest - Earth Element">üèîÔ∏è</div>
            <div class="compass-center"></div>
        </div>
        <div class="text-xs mt-2 font-semibold text-gray-700">VASTU ZONES</div>
    </div>

    <!-- Vastu Analysis Panel -->
    <div class="vastu-analysis">
        <h3 class="font-bold text-sm mb-2">Vastu Analysis</h3>
        <div class="compliance-score" id="complianceScore">85%</div>
        <div class="text-xs space-y-1 mt-2">
            <div class="text-green-600">‚úÖ Good layout</div>
            <div class="text-green-600">‚úÖ Element balance</div>
            <div class="text-yellow-600">‚ö†Ô∏è Check entrance</div>
        </div>
    </div>

    <!-- AR Controls -->
    <div class="ar-controls">
        <button class="ar-button" onclick="enterAR()">
            <i class="fas fa-cube"></i>
            Enter AR
        </button>
        <button class="ar-button" onclick="changeRoom()">
            <i class="fas fa-door-open"></i>
            Change Room
        </button>
        <button class="ar-button" onclick="vastuAnalysis()">
            <i class="fas fa-compass"></i>
            Vastu Check
        </button>
        <button class="ar-button" onclick="takeScreenshot()">
            <i class="fas fa-camera"></i>
            Capture
        </button>
        <button class="ar-button" onclick="resetView()">
            <i class="fas fa-undo"></i>
            Reset
        </button>
    </div>

    <script>
        // Interior Design Configuration
        const roomConfigs = {
            living: {
                name: 'Living Room',
                model: 'living_room',
                vastuZone: 'North',
                element: 'Air',
                recommendations: 'Place sofa in West, TV in East',
                compliance: 85
            },
            bedroom: {
                name: 'Bedroom',
                model: 'bedroom',
                vastuZone: 'Southwest',
                element: 'Earth',
                recommendations: 'Bed in Southwest, head towards South',
                compliance: 90
            },
            kitchen: {
                name: 'Kitchen',
                model: 'kitchen',
                vastuZone: 'Southeast',
                element: 'Fire',
                recommendations: 'Cooking platform facing East',
                compliance: 88
            },
            office: {
                name: 'Home Office',
                model: 'office',
                vastuZone: 'West',
                element: 'Air',
                recommendations: 'Table facing East or North',
                compliance: 82
            }
        };

        const styleConfigs = {
            modern: {
                name: 'Modern',
                colors: ['#FFFFFF', '#F4F4F4', '#C6A75E'],
                materials: ['Glass', 'Metal', 'Marble'],
                furniture: 'Sleek and minimal'
            },
            traditional: {
                name: 'Traditional',
                colors: ['#8B4513', '#D2691E', '#F4EFE6'],
                materials: ['Wood', 'Brass', 'Cotton'],
                furniture: 'Ornate and classic'
            },
            vastu: {
                name: 'Vastu',
                colors: ['#C6A75E', '#32CD32', '#87CEEB'],
                materials: ['Natural Wood', 'Stone', 'Copper'],
                furniture: 'Vastu-compliant'
            },
            minimalist: {
                name: 'Minimalist',
                colors: ['#FFFFFF', '#E0E0E0', '#808080'],
                materials: ['Concrete', 'Steel', 'Glass'],
                furniture: 'Essential pieces only'
            }
        };

        let currentRoom = 'living';
        let currentStyle = 'modern';
        let sessionId = window.location.pathname.split('/').pop() || 'demo';

        // Initialize AR Experience
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AntarAalay Interior Design AR - Session:', sessionId);
            
            // Setup event listeners
            setupDesignSelectors();
            
            // Hide loading overlay after model loads
            const modelViewer = document.getElementById('arViewer');
            modelViewer.addEventListener('load', function() {
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                    updateDesignDisplay();
                }, 1000);
            });
            
            // Initialize Vastu compass
            initializeVastuCompass();
            
            // Load initial design
            loadDesignData();
        });

        // Setup Design Selectors
        function setupDesignSelectors() {
            // Room type selectors
            document.querySelectorAll('.room-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.room-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    currentRoom = this.dataset.room;
                    updateDesignDisplay();
                    updateVastuAnalysis();
                });
            });

            // Style selectors
            document.querySelectorAll('.style-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.style-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    currentStyle = this.dataset.style;
                    updateDesignDisplay();
                    updateVastuAnalysis();
                });
            });
        }

        // Update Design Display
        function updateDesignDisplay() {
            const room = roomConfigs[currentRoom];
            const style = styleConfigs[currentStyle];
            
            document.getElementById('currentRoom').textContent = room.name;
            document.getElementById('currentStyle').textContent = style.name;
            document.getElementById('vastuElement').textContent = room.element;
            
            // Update model (in real implementation, would load different 3D models)
            updateModel();
        }

        // Update 3D Model
        function updateModel() {
            const modelViewer = document.getElementById('arViewer');
            // In production, this would load room-specific models
            console.log(`Loading ${currentRoom} model with ${currentStyle} style`);
        }

        // Initialize Vastu Compass
        function initializeVastuCompass() {
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', function(event) {
                    if (event.alpha !== null) {
                        const compass = document.getElementById('compassRing');
                        compass.style.transform = `rotate(${-event.alpha}deg)`;
                    }
                });
            }
        }

        // Update Vastu Analysis
        function updateVastuAnalysis() {
            const room = roomConfigs[currentRoom];
            const style = styleConfigs[currentStyle];
            
            // Calculate compliance score
            let compliance = room.compliance;
            if (currentStyle === 'vastu') compliance += 10;
            if (compliance > 100) compliance = 100;
            
            document.getElementById('complianceScore').textContent = compliance + '%';
            document.getElementById('vastuScore').textContent = compliance + '%';
        }

        // Enter AR Mode
        function enterAR() {
            const modelViewer = document.getElementById('arViewer');
            modelViewer.activateAR();
            console.log('Entering Interior Design AR mode...');
        }

        // Change Room Function
        function changeRoom() {
            const rooms = Object.keys(roomConfigs);
            const currentIndex = rooms.indexOf(currentRoom);
            const nextIndex = (currentIndex + 1) % rooms.length;
            currentRoom = rooms[nextIndex];
            
            // Update UI
            document.querySelectorAll('.room-option').forEach(o => o.classList.remove('selected'));
            document.querySelector(`[data-room="${currentRoom}"]`).classList.add('selected');
            
            updateDesignDisplay();
            updateVastuAnalysis();
        }

        // Vastu Analysis
        function vastuAnalysis() {
            const room = roomConfigs[currentRoom];
            alert(`üßò Vastu Analysis for ${room.name}\n\nüìç Recommended Zone: ${room.vastuZone}\nüåü Element: ${room.element}\n\nüí° Recommendations:\n${room.recommendations}\n\nCompliance Score: ${room.compliance}%`);
        }

        // Take Screenshot
        function takeScreenshot() {
            const modelViewer = document.getElementById('arViewer');
            const dataUri = modelViewer.toDataURL();
            
            const link = document.createElement('a');
            link.download = `antaralay-${currentRoom}-${currentStyle}-${Date.now()}.png`;
            link.href = dataUri;
            link.click();
            
            console.log('Interior Design AR screenshot captured!');
        }

        // Reset View
        function resetView() {
            const modelViewer = document.getElementById('arViewer');
            modelViewer.resetCamera();
            console.log('View reset');
        }

        // Load Design Data
        function loadDesignData() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const roomParam = urlParams.get('room');
                const styleParam = urlParams.get('style');
                
                if (roomParam && roomConfigs[roomParam]) {
                    currentRoom = roomParam;
                    document.querySelectorAll('.room-option').forEach(o => o.classList.remove('selected'));
                    document.querySelector(`[data-room="${currentRoom}"]`).classList.add('selected');
                }
                
                if (styleParam && styleConfigs[styleParam]) {
                    currentStyle = styleParam;
                    document.querySelectorAll('.style-option').forEach(o => o.classList.remove('selected'));
                    document.querySelector(`[data-style="${currentStyle}"]`).classList.add('selected');
                }
                
                updateDesignDisplay();
                updateVastuAnalysis();
                
            } catch (error) {
                console.error('Failed to load design data:', error);
            }
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('AR Error:', e.error);
            document.getElementById('loadingOverlay').innerHTML = `
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                    <h2 class="text-xl font-semibold mb-2">AR Experience Error</h2>
                    <p class="text-sm opacity-80">Please refresh and try again</p>
                    <button onclick="location.reload()" class="mt-4 ar-button">
                        <i class="fas fa-refresh"></i>
                        Refresh
                    </button>
                </div>
            `;
        });
    </script>
</body>
</html>
